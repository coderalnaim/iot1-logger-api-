<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>IoT Logger Control</title>
<style>
body {
  background:#0f172a; color:#e2e8f0;
  font-family:-apple-system,system-ui,sans-serif;
  padding:40px; text-align:center;
}
button {
  border:none; border-radius:12px; padding:12px 22px;
  font-size:16px; cursor:pointer; margin:10px;
}
#start {background:#22c55e;color:#052e16;}
#stop  {background:#ef4444;color:#fee2e2;}
#stop:disabled {opacity:.4;cursor:not-allowed;}
.card {
  background:#111827; padding:30px; border-radius:16px;
  display:inline-block; box-shadow:0 10px 30px rgba(0,0,0,.4);
}
.badge {
  padding:4px 8px; border-radius:8px; font-size:12px;
}
.running {background:#064e3b;color:#6ee7b7;}
.idle {background:#374151;color:#d1d5db;}
</style>
</head>
<body>

<h1>IoT Logger</h1>
<div class="card">
  <p>Start or stop synchronized multi-sensor logging.</p>
  <button id="start">Start Logging</button>
  <button id="stop" disabled>Stop & Download ZIP</button>

  <p>Status:
    <span id="statusLabel">Idle</span>
    <span id="statusBadge" class="badge idle">IDLE</span>
  </p>

  <div id="session"></div>
  <div id="msg" style="margin-top:10px;color:#93c5fd;"></div>
</div>

<script>
const bStart=document.getElementById("start");
const bStop=document.getElementById("stop");
const status=document.getElementById("statusLabel");
const badge=document.getElementById("statusBadge");
const msg=document.getElementById("msg");
const sessionBox=document.getElementById("session");

function setRunning(id,epoch,time){
  status.textContent="Running";
  badge.textContent="RUNNING";
  badge.classList.remove("idle"); badge.classList.add("running");
  bStart.disabled=true; bStop.disabled=false;
  sessionBox.innerHTML=`Session: <b>${id}</b><br>start_epoch: <code>${epoch}</code>`;
}

function setIdle(){
  status.textContent="Idle";
  badge.textContent="IDLE";
  badge.classList.add("idle"); badge.classList.remove("running");
  bStart.disabled=false; bStop.disabled=true;
  sessionBox.innerHTML="";
}

bStart.onclick=async()=>{
  msg.textContent="Starting...";
  let r=await fetch("/api/start",{method:"POST"});
  let j=await r.json();
  if(j.start_epoch){
    setRunning(j.session_id,j.start_epoch,j.start_time_utc);
    msg.textContent="Logging started.";
  }
};

bStop.onclick=async()=>{
  msg.textContent="Stopping...";
  let r=await fetch("/api/stop",{method:"POST"});
  let blob=await r.blob();

  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="session.zip";
  a.click();
  URL.revokeObjectURL(a.href);

  setIdle();
  msg.textContent="ZIP downloaded.";
};
</script>
</body>
</html>
